@startuml Skinparams

!include colors/colors.iuml
!include themes/light-professional.iuml
!include diagram-styles/diagram-styles.iuml
!include typography/typography.iuml

scale 0.95

'Common styles for all diagrams
' !define SYSTEM(txt) BOLD(CODE(<<txt>>))
' !define ARTIFACT(txt) BOLD(CODEC(<<txt>>, Blue5))


' <style>
' rectangle {
'     .dotted {
'         LineStyle 1
'         LineColor Gray5
'     }
   
'     Title {
'         ' Aligns the text/icon to the left
'         HorizontalAlignment left

'         ' Adds a little breathing room from the left border
'         Margin 5
'     }
' }
' </style>

'
'
' AWS
'
' !include <awslib/AWSCommon>
' !include <awslib/AWSSimplified>

' !foreach $item in %splitstr('General~SecurityIdentityCompliance~NetworkingContentDelivery~DeveloperTools~Database~Storage~ApplicationIntegration~Compute~Groups~MediaServices~MachineLearning~InternetOfThings~Analytics~', '~')
'     !include <awslib/$item/all.puml>
' !endfor

' !definelong AWSEntityColoring(e_stereo)
' skinparam rectangle<<e_stereo>> {
'     BackgroundColor $AWS_BG_COLOR
'     BorderColor transparent
'     Shadowing false
'     TitleHorizontalAlignment center
' }
' skinparam ParticipantBackgroundColor<<e_stereo>> $AWS_BG_COLOR
' skinparam SequenceParticipantBorderThickness<<e_stereo>> 0
' !enddefinelong

' !definelong AWSEntity(e_alias, e_label, e_techn, e_color, e_sprite, e_stereo)
' rectangle "$AWSImg(e_sprite)\ne_label" <<e_stereo>> as e_alias
' !enddefinelong

' !define Lambda(alias, label)    Lambda(alias, CODEC(<<label>>, Blue4),)
' !define API_GW(alias, label)    APIGateway(alias, CODEC(<<label>>, Blue4),)
' !define WAF(alias, label)       WAF(alias, CODEC(<<label>>, Blue4),)
' !define DynamoDB(alias, label)  DynamoDB(alias, CODEC(<<label>>, Blue4),)
' !define RDS(alias, label)       RDS(alias, CODEC(<<label>>, Blue4),)
'
'
'


'
' Auto-numbered "STEP" circles from 1 to 99 as sprites
'
' 1. Helper function to generate the SVG string with the number
!function $ONE_DIGIT_STEP($n, $color="#3d88d3ff")
!return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><circle cx="9" cy="9" r="9" fill="' + $color + '" /><text x="6" y="12" fill="#FFFFFF" font-family="sans-serif" font-size="10" style="text-decoration: none;">' + $n + '</text></svg>'
!endfunction

!function $TWO_DIGIT_STEP($n, $color="#3d88d3ff")
!return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><circle cx="9" cy="9" r="9" fill="' + $color + '" /><text x="2" y="12" fill="#FFFFFF" font-family="sans-serif" font-size="10" style="text-decoration: none;">' + $n + '</text></svg>'
!endfunction

' 2. Loop to define sprites 1 through 20 automatically
!$i = 0
!while $i <= 9
  !$name = "$Callout_" + $i
  !$svg = $ONE_DIGIT_STEP($i)
  sprite $name $svg
  !$i = $i + 1
!endwhile

' 3. Loop to define sprites 10 through 99 automatically
!$i = 10
!while $i <= 99
  !$name = "$Callout_" + $i
  !$svg = $TWO_DIGIT_STEP($i)
  sprite $name $svg
  !$i = $i + 1
!endwhile

' 3. The Accessor Function you asked for
!$_NEXT_STEP = 0
!function STEP()
  !$_NEXT_STEP = $_NEXT_STEP + 1
  !return "<$Callout_" + $_NEXT_STEP + ">"
!endfunction
'
'


'
' Common skinparams
' skinparam backgroundColor transparent
' skinparam SequenceLifeLineBackgroundColor Blue2
' skinparam SequenceArrowColor Blue4
' skinparam LegendBackgroundColor Yellow1
' skinparam SequenceDividerBackgroundColor Yellow1
' skinparam ActivityBackgroundColor Yellow1
' skinparam UsecaseBackgroundColor Yellow1
' skinparam ActorStyle awesome

' skinparam ActorBackgroundColor          Gray1
' skinparam ComponentBackgroundColor      Gray1

@enduml